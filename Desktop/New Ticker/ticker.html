<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        @font-face {
            font-family: Lucida Sans Regular;
            src: url(Lucida%20Sans%20Regular.ttf);
        }


    </style>
    <link rel="stylesheet" href="reset.css" type="text/css"/>
    <link rel="stylesheet" href="liMarquee.css" type="text/css"/>
    <script src="jquery-1.9.0.min.js"></script>
    <script src="jquery.liMarquee.js"></script>
    <script src="http://twitter.github.com/hogan.js/builds/3.0.1/hogan-3.0.1.min.js"></script>

    <script>
        var containerType = 102,
                containerID;
        window._config = {
            docID: '6548'
        };
        var Templates = {
            Ticker: Hogan.compile(document.querySelector('.template__latest_post').innerHTML)
        };

        function test() {
            Ajax.getJSON('/api/core/v3/contents?filter=entityDescriptor(' + containerType + ',' + containerID + ')', function (data) {
                var response = data.responseText.replace('throw \'allowIllegalResourceCall is false.\';', '');
                var content = response.content.text.replace(/\<\!--(.*?)--\>/gi, '');


            })
        }


        //in console: RESTWrapper.prototype.get("/api/core/v3/contents?filter=entityDescriptor(102,1072)")

    </script>

    <script>
        $(document).ready(function () {
            var requ = RESTWrapper.prototype.get("/v3/contents?filter=entityDescriptor(102,1072)");
            $.when(requ).then(function (response) {
                console.log(response);
                document.querySelector('.str_wrap').innerHTML = Templates.Ticker.render({
                    table: response
                });
            });
        });
        var answer;
        if (!window.RESTWrapper) {
            RESTWrapper = function (win, version) {
                this.win = (typeof win == 'undefined') ? window : win;
                this.version = 'v' + (typeof version == 'undefined' ? 3 : version);
            };

            RESTWrapper.prototype = {
                _query: function (method, url, params) {

                    var chunks = url.split('?');

                    if (chunks[0].indexOf('/api/core/' + this.version) == -1) url = '/api/core/' + this.version + url;

                    var def = jQuery.Deferred();

                    if (method == 'post' || method == 'put') {
                        var ajax = jQuery.ajax({
                            dataType: 'text',
                            contentType: 'application/json',
                            url: url,
                            data: JSON.stringify(params),
                            type: method
                        });
                    } else {
                        var ajax = jQuery.ajax({dataType: 'text', url: url, data: params, type: method});
                    }
                    ajax.done(function (result) {
                        if (typeof result != 'undefined') {
                            result = JSON.parse(result.replace("throw 'allowIllegalResourceCall is false.';", ''));
                        }
                        def.resolve(result);
                        answer = result;
                    });
                    ajax.fail(function (a, b, c) {
                        console.error('fail:', a, b, c);
                        answer = a;
                        def.reject(a)
                    });
                    return def.promise();
                },

                get: function (url, data) {
                    return this._query('get', url, data)
                },

                post: function (url, data) {
                    return this._query('post', url, data)
                },

                put: function (url, data) {
                    return this._query('put', url, data)
                },

                delete: function (url, data) {
                    return this._query('delete', url, data)
                },

                find: function (typeString, visibleID) {
                    var typeID;

                    var placeIDs = [4, 14, 600];

                    var typeIDs = {
                        "community": 14,
                        "space": 14,
                        "group": 4,
                        "project": 600,
                        "discussion": 1,
                        "thread": 1,
                        "document": 102
                    };

                    var typeID = typeIDs[typeString];

                    return this.get((placeIDs.indexOf(typeID) != -1 ? '/places' : '/contents') + '?filter=entityDescriptor(' + typeID + ', ' + visibleID + ')');
                },

                printFind: function (typeString, visibleID) {
                    this.find(typeString, visibleID).then(function (data) {
                        console.log(data.list[0])
                    })
                }
            };
        }

        window.rest = window.rest || new RESTWrapper(window, 3);
    </script>


</head>
<body>


<div class="wrapper">
    <div class="latest_post">latest post</div>
    <div class="str_wrap">

        <a href="#">Этим летом мне посчастливилось... </a>
        <a href="#">А потом посчастливилось осенью... </a>
        <a href="#">Сбрось мне ресет, которым ты пользуешься... </a>
    </div>
    <div class="counter">1 of 5</div>
</div>

<script type="text/x-handlebars-template" class="template__latest_post">
    {{#answer}}
    <a href="{{link}}">{{description}}</a>
    {{/answer}}
</script>

<script>
    $(window).load(function () {
        $('.str_wrap').liMarquee();
    });
</script>

</body>
</html>